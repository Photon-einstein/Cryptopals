"""
calculateSServer.py

Utilities to compute the SRP shared secret S on the server side.

This module provides:
- hex_to_bytes(hexstr) -> bytes
    Convert a hexadecimal string to raw bytes.

- calculateSServer(A_hex, v_hex, u_hex, b_hex, N_hex) -> str
    Compute the SRP server shared secret S using the formula:

        S = (A * v^u) ^ b mod N

  Parameters:
  - A_hex (str): Client public value A as a hex string.
  - v_hex (str): Verifier v as a hex string.
  - u_hex (str): Scrambling parameter u as a hex string.
  - b_hex (str): Server private exponent b as a hex string.
  - N_hex (str): Prime modulus N as a hex string.

  Returns:
  - str: Shared secret S encoded as an uppercase hex string. The result is
    zero-padded to an even length (full bytes) if necessary.

Notes:
- All hex string inputs should not include a "0x" prefix.
- This is a small helper script intended for testing and verification with
  RFC 5054 vectors; it performs integer modular arithmetic using Python's pow().
"""


def hex_to_bytes(hexstr):
    """
    Convert a hexadecimal string to bytes.

    Parameters:
    - hexstr (str): Hexadecimal string (upper/lower case allowed, no "0x" prefix).

    Returns:
    - bytes: Raw bytes represented by the hex string.

    Raises:
    - ValueError: if the input contains non-hex characters or has odd length.
    """
    return bytes.fromhex(hexstr)


def calculateSServer(A_hex, v_hex, u_hex, b_hex, N_hex):
    """
    Calculate the SRP server shared secret S.

    Formula (server side):
        S = (A * v^u) ^ b mod N

    Parameters:
    - A_hex (str): Client public value A as a hex string.
    - v_hex (str): Verifier v as a hex string.
    - u_hex (str): Scrambling parameter u as a hex string.
    - b_hex (str): Server private key 'b' as a hex string.
    - N_hex (str): Prime modulus N as a hex string.

    Returns:
    - str: Uppercase hex string of the computed shared secret S. The hex string
      is padded to an even length so it represents a whole number of bytes.
    """
    # Debug: print input parameters
    # print("[DEBUG] calculateSServer input parameters:")
    # print("  A_hex:", A_hex)
    # print("  v_hex:", v_hex)
    # print("  u_hex:", u_hex)
    # print("  b_hex:", b_hex)
    # print("  N_hex:", N_hex)
    # Convert all inputs to integers
    A = int(A_hex, 16)
    v = int(v_hex, 16)
    u = int(u_hex, 16)
    b = int(b_hex, 16)
    N = int(N_hex, 16)
    # S = (A * v^u) ^ b mod N
    Avu = (A * pow(v, u, N)) % N
    S = pow(Avu, b, N)
    # Return as uppercase hex string, padded to even length
    S_hex = format(S, "X")
    if len(S_hex) % 2 != 0:
        S_hex = "0" + S_hex
    return S_hex.upper()


if __name__ == "__main__":
    A_hex = "73E5723ACD98D363D034C12661AF2A6A168C68129E5ACBE8708762BE37D81EB2B3A477DB1016D0759D84478FB08FF278926F40DB538E540ABC6EA52F2E7F3BE57FAD20B4C0AE03A49612F66F17DAB7F0C61865E0B0C03E9544BF000620D8DB878484850DF3232CD6DC745621347B180273343FFBB72BE7FA999CDBB8A814D6740910830A4595DD8A8C332ABCB182F932A64BF1F1A61DB3F176029DAE5B1BB2488B01C6742FA3D8CF2573AEAE9EA06134A3F9B1ADB6A900C2DF6CEA9CD0DC13167277423F67E59A7C1D752BEAE75F1125B2C0DFD3085D6E0EA88CCC0BCE403B102096DA21AFCCA8721711D2E4C3B57C90EFC55D624A84410AD5BB9005625A160302520AC04EC0A9F65770EBC9568226114B99B3CB8E1B4F30BC03D7E1437B809DAE810119064915B3781F0AC2C357747CF3C3AE42736C6BB30A2D2B47AE2DB325A760886F7D2E9976F56C053B9A3EA19ED4A9C9ADEDD86704735B6AB474FA979AC8EED6E2A711BF507E78BCE36A46630AF1CDA87188CCA777E9C9A508FC7D2FA8342B864F3B9DAA50FE7D78E9D03A16DAC1960ECF4B2F3061914FB34F574ABC4ADCFD329A42CAE67D066A5318529DD7DC8CC4F17922156F9B23892F8AF4591E6113EC6EE8162627EA47CBE2F259050F50DC3711BCE89156DF4098C92DEF1C0C351A0233D03B4D3A6F7D333790D37CBACD5791F68E9846E453AE2E02FEC6F967C75C63E1DB1AD325D94B9331DC3756ED7B3D77EC9E348B4276A3FD80B55D711C1B765CA5EC8D0B6CE10CA7CA6BCA48DC1E482CC8814E6D0AFEF10A7D0C395EABADE521D5FE62328808578F91B2A50A2334B22A6BF5CAE4809AE0362135B5CD3D94E3977C8505F59B38DA4460D7F4A5DDF2FCEDC12CAF4F97D9F3FBF665895FB2BA46904B9B76375AE16C9BEF49199B4530C87BCFC3A767326BF51953BA5C04D4D0E85B1B0EA2FA389DC1678AC551979B885D5A2ACEB276A298F1987740B5EE6D0F20822C45E79D25054116EFF66A0AA77D3986503BC201498E489D58E0FC89410320487DA0D670404DAAEF9781D46C985330911A1689814CF3EE92BA8FC2F54468963B7B088DF9FD6A56787B58E76976A3B497A3F8B598F5337B849C451F3A272E8EDABA1192297EB422A41C8FA3B6D131ED6285E33D3375C91180E28EA875FDAAE149FABB7367E6CF13685E4072FA2BF9BAC8A0DB2EAAF11E040048F6DDDAC57D879D80F55BDE1F1F5DAEE8D598E7D46E754EAB79A407BB77E2C578E60B3EA0310A8EB7F043F1479465CD561D1C87E0D2D2F9026D453C8FEEFD0BB81CF3794E169295304C7126516027F8CDDCB2A4733A35953C4C5F850ECB828085E9FA3D58C44268BFFBA2A8204F302B6F6091DDE86B4126E1E44D9C0126E551DA3C43649DD20BE2ACEE67C9433F32E9A5FF25EB9122A20430E82FDA5268F5797EAB1D51D851"
    v_hex = "4693615975596F60DDF458E79BD7F7F4541208D2325FDE617EBB03596FD85E105B701D6A3875DC1DCF762FB580D7DE8DBEE9F77565D90635F061FC134C99E174812A70D6C2E062A94571433547727413DD58589307FBBF582FD22BC2BD09F9273FE14985ACC7C1B8BF6740494679EB92CCA5994B425DF3633E272DDF7E902221DDA1940D904B4350B74AC7D6DB2817BB6B6AA2785AB09A1536328AACBEDC3F4808E5670AC085BB34DD877687A0B67220F0E62DE5A4B73EA7BFE53E4F6BCB1AF9FA0916F42A4D7E1C4368122349523C9D675B69A0362245820ABEB5BC12F49509DAC23D36687511CBCBC2CBB55D086F7F954403782005CCDBE8674AA75C015DF69216475249882C13D7E37A47EF3EC600AFA3191D9084DA822F2D7DCBA0CA97BA8B2876BBAA95D64EDFC818FD4D10483A340DEE7412A3034561231876E4CEE1ABB68DAA234EC7D4093DDF90E22D502CF0618BA201B9C0626EA326C708F6293262EB2728D59C38B3E2722030C452CCE18A00CB5415CB52560C35D6A7EAE6682BC3BBE8D7C9A95975916FCC37582D65430CE5B1C900F69DB3B263B7D584222F9C6E402F3401DE7A970B53C5F87617F7F910A70F3B66F71853C08F69A89A8C8188315D8CE2801C72C3D0ED213B0C899CCE128DB45112BC385836F718F9B7A4DE10EF98FCA3BA78D68372C098126C68F2B29E7D0BEA75FDA1EEAA099786ADDE9F24B2EE4E3A95A3E948CC8BD8B26E7335FA30D53104C854F3D1B7E25CACD45E1E444FB6ADA294F431658A29C5EE4D25757BEA98A7A97C0F30F212BF7465E6500FC69082A3EED42BCCDCA0488EDAF6B4D31C02E305A6DFA3C609027C3CBF4A3AD0CA780851A9057EF09A1DAA360D12E29BB1B8604B99014C045A876F77FF033708FD2B82607860EA084EB5AF2B5D1FC973022215EDAD89F09D2BA45C364F43F01EB91D5108E4AEE4611ADFA4C853FD4BD2B4B3253E6DDD96772968321B172C4810C801762AD2587BAA33FFBFFE196A0386CD27A36A4A70A00300A115F0AEA04A12916BCAAB01408A9F72619260B5C84F7C3797293549EB74C45E3CAC9457F94712AB9DD306910A30C64D3B8400AFED712A0635E4F085D81A5FB0C51161B67D2059FE65D960F0D3EB08BD930787971B1A51E60F061E4970B1FC154722F0E8700894E4E9472EFB620DF7A8DB842A8BA78916CAEC1C45F885710B432C7E3AA79988D6D38F539AD2E49313E8634859BA0192072C91A1A30145CC28E9A474C76A270443A9D674756CC37282E618B69B9FF4145CE6C686FA1AE37080D5AAE77DC0AFF9AB04E4951D8E4904DF38AC2580E373E1B4DC7E0B04256362D8ED15F107BAB294734CCBDD1B0BE51C3F98D019ADA3693388945578675C9ADB5FC12E5A04C579FD8082CDB730B92C6CAA27D1C5FFE6C9E6DFF2C23E36AE7FD676438ADA93F46D0C5B8C54"
    u_hex = "8BB12A1587B1411E28D7AF6655ECFAFE8A44E8D020C2F8A930A3D8DFAB179D8D96739190E981C581A56199BAE2E06E1EAED404B9E69F65FF35EA5630C955C09B"
    b_hex = "23A03F08EAA9E7497A1244674D179BE44E7EDA94245634828E401F770EC9D66E135406B2AAAB485CFE6CE013E02D2E8017DA46F2C1817E61CC41762271937B56C866D21C77F958149E985D67B60EFD363B59209E1C07A88E123EDFCAB6C56A575D9FA8748A758B6C7209469C6C35D987077866DFB6232888ACD83DD8EA0B821A1912283437D3222B9550A139B87DD7AD5D8E9890CE2EDF5459AF3525884A635569482D5855842602EBE452929857D6CD7553D98DD855B39619D2A05184AA39BF385D81DAF6BD2CF342C7F20D37283FED8004B8E87869E39EBF1EFBF11EDED2BF100FCA3D05D6DD7CE5754BB067B7CEB5DB7CC038CEB353E47BE9DB8D38A20EE630A4CFF2ACFA80530273277C9686716E9C77128F8249EBEF9490B36AE57904C18C11754B723DD34233A0805AAC69EFC77854A52FCF92912B750EFC150297C2725857F84B070C914622E9C1027D29DF6824C9FF265E52FD1B88CC7B374D54CD1BBACD48632B71E79BEE8D53EA67E0B0BA494CC2251240D431FF9F5C680E23017BE8450E2037567309B400B7EA178AFEB4E39545AEC4C9620806F05FBF7B6A878C165F8A81B7E5439AD5473E8740CE2AA406A95F522C6D79553566F8B45FE87D65AEF1670CBFA16DC77C43D853B0CD70721D680552EE7D5C9FA7DAF84D6FD58CF1A65E096D2B04A9482C8116C8013896B0BF1C7665AE0D18FE1DD2DB089F4107506B0B9BF31797E78AAF4729630CA5C22F55DA87BC75C580C9B731688DDFE4573C60D42D3BDB1FEE50250DDCF195555F29F58ACB31498A88A0C6F4089DCC26179309BB56958E98CBA88905166858C4A2290B3AF8C930A4085080520FCD8E82B2E53520472B69DC3B9867389E7DBAD53577B93B8F609CE3D2A78620913F352A7B716C731CDCF7575AC0B50C2C39F1628C22583C22B9078653A490672A819A399E8A40AA8C68EEDB0B23A738D24E035011683AA101F2FF26BA2B4BDECE17CBFE2B3A78A81C0B9DD425992FD40C6676D3BBC9362AA2F2AD22E597D0A2B79EFA976D14A4DD53BA8FAFF34E652E7B11EDE09DECBEFD4AA2D0C4DF276E9DA6A10F48C3D55014CE49E764DF90D4420211CC14E4D44FB3F0BE72752BFAE0D28ADACE5356DADC189A05A5C73DA153947152E3F0C0799A4DA3AB51EC478600D3D5E102F9D8FDF45E370E7A0CC0B1B50AD3EA905D5BE8FFCB034177DD9E238A33C249C6F00D9ED51A9980C96AB24E27E48719027E98F5DF10B6B364D0E360A5FEDABDF108AACD0A2775AFE82936447BB236199DA654DB173FB957C5A0E192FF52B3E1FB726FD7D4CBD308F2E8403D324FFA59A77202CD903B98CCE666BC7E473C88C2AA53836EE46BC5D08188BB452B41C1ADB40433893DD97B015E7AA9013F0A491D7B6BBABD60FFC13713FA9A100B0D77160CCD19F024464D8075657416C65ED1CE5749C559"
    N_hex = "FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B2699C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C93402849236C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B332051512BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97FBEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AACC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58BB7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E6DBE115974A3926F12FEE5E438777CB6A932DF8CD8BEC4D073B931BA3BC832B68D9DD300741FA7BF8AFC47ED2576F6936BA424663AAB639C5AE4F5683423B4742BF1C978238F16CBE39D652DE3FDB8BEFC848AD922222E04A4037C0713EB57A81A23F0C73473FC646CEA306B4BCBC8862F8385DDFA9D4B7FA2C087E879683303ED5BDD3A062B3CF5B3A278A66D2A13F83F44F82DDF310EE074AB6A364597E899A0255DC164F31CC50846851DF9AB48195DED7EA1B1D510BD7EE74D73FAF36BC31ECFA268359046F4EB879F924009438B481C6CD7889A002ED5EE382BC9190DA6FC026E479558E4475677E9AA9E3050E2765694DFC81F56E880B96E7160C980DD98EDD3DFFFFFFFFFFFFFFFFF"
    S_hex = calculateSServer(A_hex, v_hex, u_hex, b_hex, N_hex)
    print("S_hex:", S_hex)
